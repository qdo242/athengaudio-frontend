<div class="products-page">
  <div class="container">
    <!-- Header Section -->
    <div class="page-header">
      <h1>S·∫£n ph·∫©m Audio</h1>
      <p>Kh√°m ph√° b·ªô s∆∞u t·∫≠p tai nghe v√† loa cao c·∫•p</p>
    </div>

    <!-- Search and Mobile Filter Toggle -->
    <div class="search-filter-bar">
      <div class="search-box">
        <input
          type="text"
          placeholder="T√¨m ki·∫øm s·∫£n ph·∫©m, th∆∞∆°ng hi·ªáu..."
          [(ngModel)]="searchTerm"
          (input)="onSearchChange()"
          class="search-input"
        />
        <span class="search-icon">üîç</span>
      </div>
      
      <button 
        class="mobile-filter-toggle"
        (click)="toggleMobileFilters()"
      >
        üéõÔ∏è B·ªô l·ªçc
      </button>
    </div>

    <!-- Active Filters -->
    <div class="active-filters" *ngIf="hasActiveFilters()">
      <span class="active-filter-tag" *ngIf="selectedCategory !== 'all'">
        {{ getCategoryLabel(selectedCategory) }}
        <button (click)="selectedCategory = 'all'; onFilterChange()">√ó</button>
      </span>

      <span class="active-filter-tag" *ngIf="selectedBrand !== 'all'">
        {{ selectedBrand }}
        <button (click)="selectedBrand = 'all'; onFilterChange()">√ó</button>
      </span>

      <span class="active-filter-tag" *ngFor="let conn of selectedConnectivity">
        {{ getConnectivityLabel(conn) }}
        <button (click)="removeConnectivityFilter(conn)">√ó</button>
      </span>

      <span class="active-filter-tag" *ngIf="selectedType !== 'all'">
        {{ selectedType }}
        <button (click)="selectedType = 'all'; onFilterChange()">√ó</button>
      </span>

      <span class="active-filter-tag" *ngIf="searchTerm">
        "{{ searchTerm }}"
        <button (click)="searchTerm = ''; onFilterChange()">√ó</button>
      </span>

      <button class="clear-all-btn" (click)="clearAllFilters()">
        X√≥a t·∫•t c·∫£
      </button>
    </div>

    <!-- Products Layout -->
    <div class="products-layout">
      <!-- Filters Sidebar -->
      <div class="filters-sidebar" [class.active]="showMobileFilters">
        <div class="filters-header">
          <h3>B·ªô l·ªçc</h3>
          <button class="close-filters" (click)="toggleMobileFilters()">√ó</button>
        </div>

        <!-- Category Filter -->
        <div class="filter-group">
          <h4>Danh m·ª•c</h4>
          <div class="filter-options">
            <label *ngFor="let category of categories" class="filter-option">
              <input
                type="radio"
                name="category"
                [value]="category.value"
                [(ngModel)]="selectedCategory"
                (change)="onFilterChange()"
              />
              <span class="checkmark"></span>
              {{ category.label }}
            </label>
          </div>
        </div>

        <!-- Brand Filter -->
        <div class="filter-group" *ngIf="brands.length > 0">
          <h4>Th∆∞∆°ng hi·ªáu</h4>
          <div class="filter-options">
            <label class="filter-option">
              <input
                type="radio"
                name="brand"
                value="all"
                [(ngModel)]="selectedBrand"
                (change)="onFilterChange()"
              />
              <span class="checkmark"></span>
              T·∫•t c·∫£
            </label>
            <label *ngFor="let brand of brands" class="filter-option">
              <input
                type="radio"
                name="brand"
                [value]="brand"
                [(ngModel)]="selectedBrand"
                (change)="onFilterChange()"
              />
              <span class="checkmark"></span>
              {{ brand }}
            </label>
          </div>
        </div>

        <!-- Connectivity Filter -->
        <div class="filter-group">
          <h4>K·∫øt n·ªëi</h4>
          <div class="filter-options">
            <label *ngFor="let conn of connectivityOptions" class="filter-option checkbox">
              <input
                type="checkbox"
                [value]="conn.value"
                [checked]="isConnectivitySelected(conn.value)"
                (change)="toggleConnectivity(conn.value)"
              />
              <span class="checkmark"></span>
              {{ conn.label }}
            </label>
          </div>
        </div>

        <!-- Headphone Type Filter -->
        <div class="filter-group" *ngIf="headphoneTypes.length > 0 && (selectedCategory === 'headphone' || selectedCategory === 'all')">
          <h4>Lo·∫°i tai nghe</h4>
          <div class="filter-options">
            <label class="filter-option">
              <input
                type="radio"
                name="type"
                value="all"
                [(ngModel)]="selectedType"
                (change)="onFilterChange()"
              />
              <span class="checkmark"></span>
              T·∫•t c·∫£
            </label>
            <label *ngFor="let type of headphoneTypes" class="filter-option">
              <input
                type="radio"
                name="type"
                [value]="type"
                [(ngModel)]="selectedType"
                (change)="onFilterChange()"
              />
              <span class="checkmark"></span>
              {{ type }}
            </label>
          </div>
        </div>
      </div>

      <!-- Products Grid -->
      <div class="products-grid-container">
        <div class="products-grid-header">
          <p class="results-count">
            Hi·ªÉn th·ªã <strong>{{ getProductCount() }}</strong> s·∫£n ph·∫©m
          </p>
        </div>

        <!-- Loading State -->
        <div *ngIf="isLoading" class="loading-state">
          <div class="loading-spinner"></div>
          <p>ƒêang t·∫£i s·∫£n ph·∫©m...</p>
        </div>

        <!-- Products Grid -->
        <div *ngIf="!isLoading" class="products-grid">
          <div 
            *ngFor="let product of filteredProducts" 
            class="product-card"
            [routerLink]="['/product-detail', product.id]"
          >
            <div class="product-image">
              <img [src]="product.image" [alt]="product.name" />
              <div class="product-badge" *ngIf="product.originalPrice">
                -{{ ((product.originalPrice - product.price) / product.originalPrice * 100) | number:'1.0-0' }}%
              </div>
            </div>
            
            <div class="product-info">
              <h3 class="product-name">{{ product.name }}</h3>
              <p class="product-brand">{{ product.brand }}</p>
              
              <div class="product-price">
                <span class="current-price">{{ product.price | number }}‚Ç´</span>
                <span *ngIf="product.originalPrice" class="original-price">
                  {{ product.originalPrice | number }}‚Ç´
                </span>
              </div>
              
              <div class="product-rating">
                <span class="stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</span>
                <span class="rating">({{ product.rating }})</span>
              </div>
              
              <div class="product-features">
                <span *ngFor="let feature of product.features?.slice(0, 2)" class="feature-tag">
                  {{ feature }}
                </span>
              </div>
            </div>
          </div>
        </div>

        <!-- Empty State -->
        <div *ngIf="!isLoading && filteredProducts.length === 0" class="empty-state">
          <div class="empty-icon">üéµ</div>
          <h3>Kh√¥ng t√¨m th·∫•y s·∫£n ph·∫©m</h3>
          <p>H√£y th·ª≠ ƒëi·ªÅu ch·ªânh b·ªô l·ªçc ho·∫∑c t·ª´ kh√≥a t√¨m ki·∫øm</p>
          <button class="clear-all-btn" (click)="clearAllFilters()">
            X√≥a b·ªô l·ªçc
          </button>
        </div>
      </div>
    </div>
  </div>
</div>